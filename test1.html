<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAY4tam8UPNhIERWFBZ2y7zQ0x25H7onyw&libraries=places&callback=initMap" async defer></script>

<div id="map"></div>

<style>
    #map {
        width: 60%;
        height: 450px;
        border-radius: 20px;
        margin: 20px;
        overflow: auto;
        resize: both;

    }
</style>

<script>
    function initMap() {
        var mapOptions = {
            zoom: 15
        };

        var map = new google.maps.Map(document.getElementById('map'), mapOptions);
        var userMarker;

        var watchId = navigator.geolocation.watchPosition(function (position) {
            var userLatLng = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };

            map.setCenter(userLatLng);

            if (userMarker) {
                userMarker.setPosition(userLatLng);
            } else {
                userMarker = new google.maps.Marker({
                    position: userLatLng,
                    map: map,
                    title: 'Your Location',
                    icon: 'https://maps.google.com/mapfiles/kml/paddle/grn-circle.png'
                });

                google.maps.event.addListener(userMarker, 'click', function () {
                    alert('Your Location clicked!');
                });

                // Check if PlacesService is available before calling searchNearbyHospitals
                if (google.maps.places) {
                    searchNearbyHospitals(map, userLatLng);
                } else {
                    console.error('PlacesService is not available.');
                }
            }
        }, function () {
            alert('Error: The Geolocation service failed.');
        });
    }

    function searchNearbyHospitals(map, location) {
        var request = {
            location: location,
            radius: 10000,
            query: 'hospital emergency'
        };

        var service = new google.maps.places.PlacesService(map);

        service.textSearch(request, function (results, status) {
            if (status == google.maps.places.PlacesServiceStatus.OK) {
                for (var i = 0; i < results.length; i++) {
                    createHospitalMarker(map, results[i]);
                }
            } else {
                console.error('Error in PlacesService request: ' + status);
            }
        });
    }

    function createHospitalMarker(map, place) {
        var marker = new google.maps.Marker({
            map: map,
            position: place.geometry.location,
            title: place.name,
            icon: 'https://maps.gstatic.com/mapfiles/ms2/micons/hospitals.png'
        });

        google.maps.event.addListener(marker, 'click', function () {
            alert(place.name + ' clicked!');
        });
    }
</script>
